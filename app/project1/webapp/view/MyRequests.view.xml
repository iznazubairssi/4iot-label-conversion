<!-- app/project1/webapp/view/MyRequests.view.xml -->
<mvc:View
    controllerName="label.conversion.project1.controller.MyRequests"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns="sap.m"
    xmlns:core="sap.ui.core"
    height="100%"
>
    <Page
        id="idMyRequestsPage"
        title="My Conversion Requests"
        showNavButton="true"
        navButtonPress="onNavBack"
    >
        <content>
            <VBox class="sapUiSmallMargin">
                <Toolbar>
                    <Title text="All Requests" level="H2"/>
                    <ToolbarSpacer />
                    <Button
                        text="Refresh"
                        icon="sap-icon://refresh"
                        press="onRefresh"
                    />
                    <Button
                        text="New Request"
                        icon="sap-icon://add"
                        type="Emphasized"
                        press="onNavigateToNewRequest"
                    />
                </Toolbar>

                <Table
                    id="idRequestsTable"
                    items="{
                        path: '/Requests',
                        sorter: {
                            path: 'createdAt',
                            descending: true
                        }
                    }"
                    growing="true"
                    growingThreshold="20"
                    mode="SingleSelectMaster"
                    selectionChange="onRequestSelect"
                >
                    <headerToolbar>
                        <OverflowToolbar>
                            <content>
                                <Title text="Requests" level="H3"/>
                                <ToolbarSpacer />
                                <SearchField
                                    width="20%"
                                    search="onSearch"
                                    placeholder="Search by ID or Name"
                                />
                            </content>
                        </OverflowToolbar>
                    </headerToolbar>
                    <columns>
                        <Column width="20%">
                            <Text text="Request ID" />
                        </Column>
                        <Column width="15%">
                            <Text text="Submitted" />
                        </Column>
                        <Column width="10%">
                            <Text text="Status" />
                        </Column>
                        <Column width="15%">
                            <Text text="Contact" />
                        </Column>
                        <Column width="10%">
                            <Text text="Labels" />
                        </Column>
                        <Column width="15%">
                            <Text text="Software" />
                        </Column>
                        <Column width="15%">
                            <Text text="Actions" />
                        </Column>
                    </columns>
                    <items>
                        <ColumnListItem type="Active">
                            <cells>
                                <ObjectIdentifier 
                                    title="{ID}"
                                    text="{contactName}"
                                />
                                <Text 
                                    text="{
                                        path: 'createdAt',
                                        type: 'sap.ui.model.type.DateTime',
                                        formatOptions: {
                                            style: 'short'
                                        }
                                    }"
                                />
                                <ObjectStatus 
                                    text="{
                                        path: 'status',
                                        formatter: '.formatStatus'
                                    }"
                                    state="{
                                        path: 'status',
                                        formatter: '.formatStatusState'
                                    }"
                                    icon="{
                                        path: 'status',
                                        formatter: '.formatStatusIcon'
                                    }"
                                />
                                <VBox>
                                    <Text text="{contactName}" />
                                    <Text text="{contactMail}" class="sapUiTinyMarginTop"/>
                                </VBox>
                                <ObjectNumber 
                                    number="{numLabels}"
                                    unit="labels"
                                />
                                <Text text="{labelSoftware}" />
                                <HBox>
                                    <Button 
                                        icon="sap-icon://detail-view"
                                        type="Transparent"
                                        press="onViewDetails"
                                        tooltip="View Details"
                                    />
                                    <Button 
                                        icon="sap-icon://download"
                                        type="Transparent"
                                        press="onDownload"
                                        visible="{= ${status} === 100 }"
                                        tooltip="Download Files"
                                    />
                                </HBox>
                            </cells>
                        </ColumnListItem>
                    </items>
                </Table>

                <!-- Empty state -->
                <IllustratedMessage
                    id="idEmptyState"
                    visible="false"
                    illustrationType="sapIllustratedMessage-NoData"
                    title="No Requests Found"
                    description="You haven't submitted any conversion requests yet."
                >
                    <additionalContent>
                        <Button
                            text="Create New Request"
                            type="Emphasized"
                            press="onNavigateToNewRequest"
                        />
                    </additionalContent>
                </IllustratedMessage>
            </VBox>
        </content>
    </Page>
</mvc:View>
